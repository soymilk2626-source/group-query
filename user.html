<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HXH獵人揪團｜查詢</title>
  <link rel="stylesheet" href="style.css"><!-- 共用CSS -->
</head>
<body>

    </div>

    <div class="card" id="userApp">
  <style>
    :root{
      --navy:#1f2a44;
      --yellow:#f5c451;
      --bg:#fafafa;
      --line:#e6e6e6;
      --paid:#2e7d32;
      --unpaid:#c62828;
    }

    body{
      margin:0;
      background:var(--bg);
      font-family:-apple-system,BlinkMacSystemFont,"Hiragino Sans","Noto Sans JP","PingFang TC","Microsoft JhengHei",sans-serif;
      color:#222;
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:28px 16px 60px;
    }

    h1{
      margin:0 0 8px;
      font-size:28px;
      color:var(--navy);
      letter-spacing:1px;
    }

    .subtitle{
      font-size:14px;
      line-height:1.7;
      color:#555;
      margin-bottom:20px;
    }
    .subtitle b{ color:var(--navy); }
    .subtitle a{
      color:var(--navy);
      text-decoration:underline;
      font-weight:600;
    }

    /* ===== 查詢區 ===== */
    .search{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin:22px 0 12px;
      align-items:center;
    }

    .search input{
      flex:1;
      min-width:200px;
      padding:12px 14px;
      border:1px solid var(--line);
      border-radius:10px;
      font-size:15px;
      background:#fff;
    }

    .search button{
      padding:12px 22px;
      border-radius:10px;
      border:none;
      background:var(--navy);
      color:#fff;
      font-size:15px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:10px;
    }
    .search button:disabled{
      opacity:.65;
      cursor:not-allowed;
    }

    /* 查詢中 spinner */
    .spinner{
      width:16px;
      height:16px;
      border:2px solid rgba(255,255,255,.45);
      border-top-color:#fff;
      border-radius:50%;
      animation:spin .8s linear infinite;
      display:none;
    }
    .loading .spinner{ display:inline-block; }
    @keyframes spin{ to{ transform:rotate(360deg); } }

    .statusline{
      margin:6px 0 10px;
      color:#666;
      font-size:13px;
      min-height:18px;
    }

    /* ===== Tabs ===== */
    .tabs{
      display:flex;
      gap:8px;
      margin:14px 0 10px;
    }

    .tab{
      padding:6px 14px;
      border-radius:999px;
      font-size:13px;
      border:1px solid var(--line);
      cursor:pointer;
      background:#fff;
      user-select:none;
    }

    .tab.active{
      background:var(--yellow);
      border-color:var(--yellow);
      font-weight:700;
    }

    /* ===== Summary ===== */
    .summary{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin:16px 0 22px;
    }

    .sum{
      background:#fff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 16px;
      font-size:14px;
    }

    .sum b{ font-size:16px; }

    /* ===== Table ===== */
    table{
      width:100%;
      border-collapse:collapse;
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
    }

    thead{ background:#f1f3f6; }

    th, td{
      padding:12px 10px;
      text-align:left;
      font-size:14px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
    }

    th{
      color:var(--navy);
      font-weight:700;
      font-size:13px;
    }

    tr:last-child td{ border-bottom:none; }
    .right{ text-align:right; }

    .muted{ color:#777; font-size:12px; }

    /* 狀態 badge：不換行 + 顏色 */
    .status-badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      white-space:nowrap;      /* ✅ 不換行 */
      padding:6px 10px;
      border-radius:999px;
      font-size:13px;
      line-height:1;
      min-width:56px;
      font-weight:700;
    }
    .paid{
      background:#e8f5e9;
      color:var(--paid);
    }
    .unpaid{
      background:#ffebee;
      color:var(--unpaid);
    }

    /* 手機：隱藏團別欄（你原本也有） */
    @media(max-width:720px){
      th:nth-child(3), td:nth-child(3){
        display:none;
      }
    }

    .errorbox{
      background:#fff3f3;
      border:1px solid #ffd0d0;
      color:#a40000;
      padding:10px 12px;
      border-radius:12px;
      font-size:13px;
      margin:10px 0;
      white-space:pre-wrap;
    }
  </style>
    </div>

    <div class="card">
      <a href="index.html" class="muted">← 回入口</a>
    </div>
  </div>

  <script src="app.js"></script><!-- 共用JS工具 -->
</head>

<body>
<div class="user-hero">
  <h1 class="hero-title">HXH獵人揪團，一起來敗家！！</h1>

  <p class="hero-desc">
    這是 HXH 限定揪團！！<br>
    目前主要在 LINE 上活動，有現貨才會在其他地方發布。<br>
    有任何問題都可以直接私訊我的帳號或來信給我～<br>
    FB：Hau May Dun ｜ Email：soymilk2626@gmail.com<br>
    <a href="https://line.me/R/ti/g/cH22OTt-IX" target="_blank" style="color:#f5c451;font-weight:900;text-decoration:underline;">
      >> 點我進群組 <<
    </a>
  </p>
</div>

<div class="top-links">
  <a class="timeline" href="timeline.html">到貨時間軸</a>
  <a href="index.html">回入口</a>
  <a href="#" onclick="alert('待更新'); return false;">其他連結</a>
</div>

  <div class="search">
    <input id="name" placeholder="暱稱（FB / LINE 名稱）">
    <input id="key" placeholder="查詢密碼">
    <button id="go">
      <span class="spinner" aria-hidden="true"></span>
      <span class="btn-text">查詢</span>
    </button>
  </div>

  <div id="status" class="statusline"></div>

<div class="tabs">
  <div class="tab active" data-ut="orders">訂單明細</div>
  <div class="tab" data-ut="payments">付款明細</div>
</div>

<div id="list"></div>


  <div class="summary" id="summary" style="display:none">
    <div class="sum">已付：<b id="paid"></b></div>
    <div class="sum">未付：<b id="unpaid"></b></div>
    <div class="sum">總計：<b id="all"></b></div>
  </div>
        
<div id="loading" class="loading" style="display:none;">
  查詢中，請稍候…
</div>

  <div id="list"></div>

</div>
  
<script>

let currentTab = "orders";
let userData = null; // 查詢回來的資料：包含 details / payments

// tab 切換
document.querySelectorAll(".tab[data-ut]").forEach(t=>{
  t.addEventListener("click", ()=>{
    document.querySelectorAll(".tab[data-ut]").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    currentTab = t.dataset.ut;
    render();
  });
});

// 查詢成功後，把 data 存起來再 render
async function runQuery(){
  // ...你原本查詢 fetch 的內容保留...
  // 查到資料後做：
  // userData = data;
  // render();
}

function render(){
  const listEl = document.getElementById("list");
  if(!userData){
    listEl.innerHTML = "";
    return;
  }

  if(currentTab === "payments"){
    const pays = userData.payments || [];
    if(!pays.length){
      listEl.innerHTML = `<div class="muted">沒有付款紀錄</div>`;
      return;
    }

    let html = `
      <div class="table-wrap">
        <table>
          <thead><tr><th>時間</th><th class="right">金額</th><th>備註</th></tr></thead>
          <tbody>
    `;
    pays.forEach(p=>{
      html += `
        <tr>
          <td>${esc(p.paid_at||"")}</td>
          <td class="right">${fmt(p.amount)}</td>
          <td class="muted">${esc(p.note||"")}</td>
        </tr>
      `;
    });
    html += `</tbody></table></div>`;
    listEl.innerHTML = html;
    return;
  }

  // orders（訂單明細）
  const rows = userData.details || [];
  if(!rows.length){
    listEl.innerHTML = `<div class="muted">沒有訂單資料</div>`;
    return;
  }

  let html = `
    <div class="table-wrap">
      <table>
        <thead>
          <tr>
            <th>團別</th>
            <th>品項</th>
            <th class="center">數量</th>
            <th class="right">金額</th>
            <th class="center">到貨</th>
            <th class="center">包/出</th>
          </tr>
        </thead>
        <tbody>
  `;

  rows.forEach(d=>{
    const qty = Number(d.qty||0);
    const aq  = Number(d.arrived_qty||0);
    html += `
      <tr>
        <td class="muted">${esc(d.group||"")}</td>
        <td>${esc(d.item||"")}</td>
        <td class="center">${esc(qty)}</td>
        <td class="right">${fmt(d.amount)}</td>
        <td class="center">${esc(aq)}/${esc(qty)}</td>
        <td class="center">
          <div class="muted">${esc(d.pack_status||"未包")}${d.packed_at? "@" + esc(d.packed_at):""}</div>
          <div class="muted">${esc(d.ship_status||"未出")}${d.shipped_at? "@" + esc(d.shipped_at):""}</div>
        </td>
      </tr>
    `;
  });

  html += `</tbody></table></div>`;
  listEl.innerHTML = html;
}

</script>
</body>
</html>
