<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>HXH獵人揪團，一起來敗家！！</title>

  <style>
    :root{
      --navy:#1f2a44;
      --yellow:#f5c451;
      --bg:#fafafa;
      --line:#e6e6e6;
      --paid:#2e7d32;
      --unpaid:#c62828;
    }

    body{
      margin:0;
      background:var(--bg);
      font-family:
        -apple-system,
        BlinkMacSystemFont,
        "Hiragino Sans",
        "Noto Sans JP",
        "PingFang TC",
        "Microsoft JhengHei",
        sans-serif;
      color:#222;
    }

    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:28px 16px 60px;
    }

    h1{
      margin:0 0 8px;
      font-size:28px;
      color:var(--navy);
      letter-spacing:1px;
    }

    .subtitle{
      font-size:14px;
      line-height:1.7;
      color:#555;
      margin-bottom:20px;
    }

    .subtitle b{ color:var(--navy); }

    .subtitle a{
      color:var(--navy);
      text-decoration:underline;
      font-weight:600;
    }

    /* ===== 查詢區 ===== */
    .search{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin:22px 0;
    }

    .search input{
      flex:1;
      min-width:200px;
      padding:12px 14px;
      border:1px solid var(--line);
      border-radius:10px;
      font-size:15px;
    }

    .search button{
      padding:12px 22px;
      border-radius:10px;
      border:none;
      background:var(--navy);
      color:#fff;
      font-size:15px;
      cursor:pointer;
    }

    .search button:hover{
      opacity:.9;
    }

    /* ===== Tabs ===== */
    .tabs{
      display:flex;
      gap:8px;
      margin:14px 0 10px;
    }

    .tab{
      padding:6px 14px;
      border-radius:999px;
      font-size:13px;
      border:1px solid var(--line);
      cursor:pointer;
      background:#fff;
    }

    .tab.active{
      background:var(--yellow);
      border-color:var(--yellow);
      font-weight:700;
    }

    /* ===== Summary ===== */
    .summary{
      display:flex;
      gap:12px;
      flex-wrap:wrap;
      margin:16px 0 22px;
    }

    .sum{
      background:#fff;
      border:1px solid var(--line);
      border-radius:12px;
      padding:12px 16px;
      font-size:14px;
    }

    .sum b{ font-size:16px; }

    /* ===== Table ===== */
    table{
      width:100%;
      border-collapse:collapse;
      background:#fff;
      border:1px solid var(--line);
      border-radius:14px;
      overflow:hidden;
    }

    thead{
      background:#f1f3f6;
    }

    th, td{
      padding:12px 10px;
      text-align:left;
      font-size:14px;
      border-bottom:1px solid var(--line);
      vertical-align:top;
    }

    th{
      color:var(--navy);
      font-weight:700;
      font-size:13px;
    }

    tr:last-child td{
      border-bottom:none;
    }

    .right{ text-align:right; }

    .badge{
      padding:2px 8px;
      border-radius:999px;
      font-size:12px;
      font-weight:700;
      display:inline-block;
    }

    .paid{
      background:#e8f5e9;
      color:var(--paid);
    }

    .unpaid{
      background:#ffebee;
      color:var(--unpaid);
    }

    .muted{
      color:#777;
      font-size:12px;
    }

    .group-title{
      margin:26px 0 8px;
      font-weight:800;
      color:var(--navy);
      font-size:15px;
    }

    @media(max-width:720px){
      th:nth-child(3), td:nth-child(3){
        display:none;
      }
    }
    .status-badge{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  white-space:nowrap;   /* ✅ 不換行 */
  padding:6px 10px;
  border-radius:999px;
  font-size:13px;
  line-height:1;
  min-width:56px;       /* ✅ 給足夠寬度，避免擠爆 */
}

  </style>
</head>

<body>
<div class="wrap">

  <h1>HXH獵人揪團，一起來敗家！！</h1>

  <div class="subtitle">
    <b>這是 HXH 限定揪團！！</b><br>
    目前主要在 LINE 上活動，有現貨才會在其他地方發布。<br>
    有任何問題都可以直接私訊我的帳號或來信給我～<br>
    FB：Hau May Dun ｜ Email：soymilk2626@gmail.com<br>
    <a href="https://line.me/R/ti/g/cH22OTt-IX" target="_blank">>> 點我進群組 <<</a>
  </div>

  <div class="search">
    <input id="name" placeholder="暱稱（FB / LINE 名稱）">
    <input id="key" placeholder="查詢密碼">
    <button id="go">查詢</button>
  </div>

  <div class="tabs">
    <div class="tab active" data-filter="all">全部</div>
    <div class="tab" data-filter="unpaid">未付款</div>
    <div class="tab" data-filter="paid">已付款</div>
  </div>

  <div class="summary" id="summary" style="display:none">
    <div class="sum">已付：<b id="paid"></b></div>
    <div class="sum">未付：<b id="unpaid"></b></div>
    <div class="sum">總計：<b id="all"></b></div>
  </div>

  <div id="list"></div>

</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbzwEAj6nG_MdvHoMWJ_KrggB17o15xiIgWyo-zosvLLbrHb87Fabs6leAb9CIQJ6soS/exec";

let rawDetails = [];
let currentFilter = "all";

document.getElementById("go").addEventListener("click", run);
document.querySelectorAll(".tab").forEach(t=>{
  t.onclick = ()=>{
    document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
    t.classList.add("active");
    currentFilter = t.dataset.filter;
    render();
  };
});

async function run(){
  const name = document.getElementById("name").value.trim();
  const key  = document.getElementById("key").value.trim();
  if(!name || !key){ alert("請輸入暱稱與密碼"); return; }

  const url = `${API_URL}?q=${encodeURIComponent(name)}&key=${encodeURIComponent(key)}`;
  const res = await fetch(url);
  const data = await res.json();

  if(!data.ok){ alert(data.message || "查詢失敗"); return; }

  rawDetails = data.details || [];
  document.getElementById("paid").textContent = fmt(data.total_paid);
  document.getElementById("unpaid").textContent = fmt(data.total_unpaid);
  document.getElementById("all").textContent = fmt(data.total_all);
  document.getElementById("summary").style.display = "";

  render();
}

function render(){
  let list = rawDetails.filter(d=>{
    const isPaid = String(d.pay_status||"").includes("已");
    if(currentFilter==="paid") return isPaid;
    if(currentFilter==="unpaid") return !isPaid;
    return true;
  });

  if(!list.length){
    document.getElementById("list").innerHTML = "<div class='muted'>沒有資料</div>";
    return;
  }

  let html = `
  <table>
    <thead>
      <tr>
        <th>品項</th>
        <th>數量</th>
        <th>團別</th>
        <th class="right">金額</th>
        <th>狀態</th>
      </tr>
    </thead>
    <tbody>
  `;

  list.forEach(d=>{
    const isPaid = String(d.pay_status||"").includes("已");
    html += `
      <tr>
        <td>${d.item||""}</td>
        <td>${d.qty||""}</td>
        <td class="muted">${d.group || d.sheet || ""}</td>
        <td class="right">${fmt(d.amount)}</td>
        <td>
          <span class="status-badge badge ${isPaid?"paid":"unpaid"}">${d.pay_status}</span>
        </td>
      </tr>
    `;
  });

  html += "</tbody></table>";
  document.getElementById("list").innerHTML = html;
}


  let html = `
  <table>
    <thead>
      <tr>
        <th>品項</th>
        <th>數量</th>
        <th>團別</th>
        <th class="right">金額</th>
        <th>狀態</th>
      </tr>
    </thead>
    <tbody>
  `;

  list.forEach(d=>{
    const isPaid = String(d.pay_status||"").includes("已");
    html += `
      <tr>
        <td>${d.item||""}</td>
        <td>${d.qty||""}</td>
        <td class="muted">${d.group || d.sheet || ""}</td>
        <td class="right">${fmt(d.amount)}</td>
        <td><span class="badge ${isPaid?"paid":"unpaid"}">${d.pay_status}</span></td>
      </tr>
    `;
  });

  html += "</tbody></table>";
  document.getElementById("list").innerHTML = html;
}

function fmt(n){
  return Number(n||0).toLocaleString("zh-Hant-TW");
}
</script>

</body>
</html>
